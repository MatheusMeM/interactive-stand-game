# app/ui/screens.kv
#:kivy 2.1.0

# Define brand colors for reusability
#:set color_primary_blue (0/255, 64/255, 119/255, 1)      # #004077
#:set color_secondary_blue (0/255, 105/255, 180/255, 1)      # #004077
#:set color_primary_green (134/255, 188/255, 37/255, 1)   # #86BC25
#:set color_secondary_green (82/255, 174/255, 50/255, 1)   # #86BC25
#:set color_white (1, 1, 1, 1)
#:set color_dark_gray (137/255, 137/255, 137/255, 1) # rgba(137, 137, 137, 1)
#:set color_light_gray (216/255, 206/255, 205/255, 1) # rgba(216, 206, 205, 1)
#:set screen_padding dp(60)

# Base styles for widgets to maintain consistency
<BrandedButton@Button>:
    font_name: 'Roboto'
    background_color: 0,0,0,0 # Make the default background transparent
    color: color_primary_blue
    font_size: '70sp'
    bold: True
    background_normal: ''

    canvas.before:
        Color:
            # Use the button's state to change color on press
            rgba: color_primary_green if self.state == 'normal' else color_secondary_green
        RoundedRectangle:
            pos: self.pos
            size: self.size
            radius: [dp(30)] # The radius for the rounded corners. dp(20) is a good starting point.


<BrandedLabel@Label>:
    font_name: 'Roboto'
    color: color_primary_blue
    halign: 'center'
    valign: 'middle'

# --- Screen Designs ---

<WelcomeScreen>:
    name: 'welcome'
    canvas.before:
        Color:
            rgba: color_white
        Rectangle:
            pos: self.pos
            size: self.size
    FloatLayout:
        Image:
            source: 'assets/images/background_graphic.png'
            allow_stretch: True
            keep_ratio: False
            opacity: 0.15
        Image:
            source: 'assets/images/ibp_logo.png'
            size_hint: 0.55, 0.55
            pos_hint: {'center_x': 0.5, 'center_y': 0.6}
        BrandedButton:
            text: 'Toque para come√ßar'
            size_hint: 0.8, 0.15
            pos_hint: {'center_x': 0.5, 'center_y': 0.15}
            on_press: app.game_manager.show_instructions()

<InstructionsScreen>:
    name: 'instructions'
    canvas.before:
        Color:
            rgba: color_white
        Rectangle:
            pos: self.pos
            size: self.size
    Image:
        source: 'assets/images/background_graphic.png'
        allow_stretch: True
        keep_ratio: False
        opacity: 0.15

    # Main layout that respects the global screen padding
    BoxLayout:
        orientation: 'vertical'
        padding: screen_padding
        spacing: dp(25)
        Image:
            source: 'assets/images/ibp_logo.png'
            size_hint: 1, 0.2
            allow_stretch: True
            keep_ratio: True
        # --- TOP 5/8: The Dialog Box ---
        BoxLayout:
            size_hint_y: 0.625 # This is 5/8
            padding: dp(30)
            canvas.before:
                Color:
                    rgba: color_light_gray
                RoundedRectangle:
                    pos: self.pos
                    size: self.size
                    radius: [dp(30)]
            BoxLayout:
                orientation: 'vertical'
                spacing: dp(15)
                
                BrandedLabel:
                    id: title_label # <-- The missing ID
                    text: 'Placeholder Title'
                    font_size: '40sp'
                    bold: True
                    size_hint_y: None
                    height: self.texture_size[1] # Make height fit the text
                    halign: 'left'

                BrandedLabel:
                    id: body_label
                    text: 'Placeholder Body Text'
                    markup: True
                    font_size: '32sp'
                    text_size: self.width, None
                    valign: 'top'
                    halign: 'left'

        # --- BOTTOM 3/8: The Start Button and Logo ---
        BoxLayout:
            size_hint_y: 0.375 # This is 3/8
            orientation: 'vertical'
            spacing: dp(20)
            
            BrandedButton:
                id: action_button # <-- NEW ID
                text: 'PLACEHOLDER' # Will be replaced by GameManager
                size_hint: 1, 0.7
                # --- CHANGED: A new generic callback ---
                on_press: app.game_manager.proceed_from_instructions()
            



<AgilityGameScreen>:
    name: 'agility_game'
    canvas.before:
        Color:
            rgba: color_dark_gray
        Rectangle:
            pos: self.pos
            size: self.size
    
    FloatLayout:
        # Subtle branding watermark in the background
        Image:
            source: 'assets/images/ibp_logo.png'
            opacity: 0.1
            size_hint: 0.5, 0.5
            pos_hint: {'center_x': 0.5, 'center_y': 0.5}

        # Top bar for score and round info
        BoxLayout:
            pos_hint: {'top': 1}
            size_hint_y: 0.1
            padding: (dp(20), 0)
            BrandedLabel:
                id: round_label
                text: 'Round: 0 / 5'
                font_size: '30sp'
                color: color_white
            BrandedLabel:
                id: score_label
                text: 'Score: 0'
                font_size: '30sp'
                color: color_white

        # Main countdown/feedback label, centered
        BrandedLabel:
            id: countdown_label
            text: 'Prepare-se!'
            font_size: '150sp'
            bold: True
            pos_hint: {'center_x': 0.5, 'center_y': 0.5}
            color: color_white
            # Add scale property for animation
            scale: 1.0

        # Reinforcing instruction label, initially hidden
        BrandedLabel:
            id: instruction_label
            text: ''
            font_size: '28sp'
            pos_hint: {'center_x': 0.5, 'center_y': 0.25}
            color: color_primary_green
            opacity: 0

<QuizGameScreen>:
    name: 'quiz_game'
    canvas.before:
        Color:
            rgba: color_white
        Rectangle:
            pos: self.pos
            size: self.size
    Image:
        source: 'assets/images/background_graphic.png'
        allow_stretch: True
        keep_ratio: False
        opacity: 0.15
    BoxLayout:
        orientation: 'vertical'
        padding: 50
        spacing: 20
        BrandedLabel:
            id: question_label
            text: '...'
            font_size: '30sp'
            size_hint_y: 0.4
            text_size: self.width, None
        GridLayout:
            cols: 2
            spacing: 15
            BrandedButton:
                id: option_1
                on_press: app.game_manager.check_answer(self.text)
            BrandedButton:
                id: option_2
                on_press: app.game_manager.check_answer(self.text)
            BrandedButton:
                id: option_3
                on_press: app.game_manager.check_answer(self.text)
            BrandedButton:
                id: option_4
                on_press: app.game_manager.check_answer(self.text)
        BrandedLabel:
            id: feedback_label
            text: ''
            font_size: '25sp'
            size_hint_y: 0.15

<ScoreScreen>:
    name: 'score'
    canvas.before:
        Color:
            rgba: color_white
        Rectangle:
            pos: self.pos
            size: self.size
    Image:
        source: 'assets/images/background_graphic.png'
        allow_stretch: True
        keep_ratio: False
        opacity: 0.15
    BoxLayout:
        orientation: 'vertical'
        padding: 50
        spacing: 20
        BrandedLabel:
            text: 'Congratulations!'
            font_size: '50sp'
        BrandedLabel:
            id: final_score_label
            text: 'Your Final Score: 0'
            font_size: '40sp'
        TextInput:
            id: name_input
            hint_text: 'ENTER YOUR INITIALS'
            font_name: 'Roboto'
            font_size: '35sp'
            multiline: False
            readonly: True
            halign: 'center'
            size_hint_y: None
            height: '60dp'
        BrandedButton:
            text: 'Submit Score'
            on_press: app.game_manager.submit_score(name_input.text)
        VKeyboard:
            target: name_input
            layout: 'qwerty'

<LeaderboardScreen>:
    name: 'leaderboard'
    canvas.before:
        Color:
            rgba: color_white
        Rectangle:
            pos: self.pos
            size: self.size
    Image:
        source: 'assets/images/background_graphic.png'
        allow_stretch: True
        keep_ratio: False
        opacity: 0.15
    BoxLayout:
        orientation: 'vertical'
        padding: 20
        spacing: 10
        BrandedLabel:
            text: 'Hall of Fame'
            font_size: '50sp'
            size_hint_y: 0.2
        BrandedLabel:
            id: congrats_label
            text: ''
            font_size: '30sp'
            size_hint_y: 0.1
            color: color_primary_green
        GridLayout:
            id: leaderboard_grid
            cols: 3
            size_hint_y: 0.6
        BrandedButton:
            text: 'Play Again'
            size_hint_y: 0.1
            on_press: app.game_manager.return_to_welcome()